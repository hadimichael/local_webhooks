var httpreq = require('httpreq');

function LocalWebhook(options) {
	console.log("LocalWebhook was created.");
	if(!options.ip) {
		throw new Error('No IP defined.');
		return;
	}
	
	this.ip = options.ip;
	
	return this;
	
}
/*
	send([callback])
*/
LocalWebhook.prototype.send = function(arg1){
	console.log("LocalWebhook.send was fired with arg1: " + arg1);
	console.log("LocalWebhook.send IP: " + this.ip);
	send(this.ip);
	
	if( arguments.length == 0){
		send(this.ip);
	}
	if( arguments.length == 1){
		// (cb)
		if(typeof(arg1)==="function"){
			send(this.ip);
			send({
				ip: this.ip
			}, arg1);
		}
	}
	
}

function send(ip, callback){
	console.log("LocalWebhook function send() was fired with IP: " + ip);
	httpreq.get(ip, function(err, res){
		if(err){
			console.log("err");
			console.log(err);
		}
		if(res){
			console.log("res");
			console.log(res);
		
		if(callback && typeof callback === "function"){
			if(err){
				callback(err);
			} else {
				callback(res);
			}
		}
	});
}

module.exports = LocalWebhook;